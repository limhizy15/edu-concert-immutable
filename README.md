# 불변 객체를 활용하는 법 실습

## 실습 목표

- [​테스트 패키지](https://github.com/next-step/edu-concert-immutable/tree/main/src/test/kotlin/camp/nextstep/edu/immutable)에 실습을 위한 다양한 테스트 케이스들이 단계별로 존재합니다.
- 모두 Fail되고 있는 이 케이스들을 전부 성공하도록 만드는 것이 실습 목표입니다.

## Tip

- 모든 실습은 저희가 매칭해드리는 파트너와 함께하시게 됩니다.
- 진행하시는 동안 어려움이 생긴다면 주변을 돌아다니고 있는 코치들을 마음껏 활용하시며 편하게 질문해주시면 됩니다. 🙂

## 실습 환경

- 최신 버전의 IntelliJ IDEA 설치가 필요합니다.
- [이곳](https://www.jetbrains.com/ko-kr/idea/download/#section=mac)에서 다운받으실 수 있습니다.

# 단계별 실습

## Step1 - 불변 객체란?

- 변경되지 않는 객체, 변경할 수 없는 객체다.
- String, Int, Long와 같은 원시 타입도 불변 객체의 일종이다.

### 힌트

- Employee의 이름을 변경하더라도 객체의 이름을 직접 접근하여 변경하기보다, 변경된 이름을 리턴하는 새로운 객체를 만들어보자.

## Step2 - 방어적 복사란?

- 기존 객체와 똑같은 객체를 만드는 것이다.
- 외부에서 객체를 변경해도 내부의 객체는 변경되지 않는다.

### 왜 방어적 복사를 해야 할까?

- 같은 객체끼리의 변경이 공유되는 것을 막을 수 있다.
  - 외부 → 내부 (List로 공개되었더라도 구현체가 MutableList이면 공격 가능)
  - 내부 → 외부 (내부에서 MutableList로 사용하기 때문에 외부에서 List로 사용하더라도 값이 변경될 수 있음)
- 불변 객체를 활용하지 않더라도 방어적 복사를 이용하면 대부분의 side effect와 관련된 이슈를 방지할 수 있다.

### 힌트

- 외부에서 복사된 컬렉션의 값을 임의로 조작하더라도 원본 데이터는 유지되어야 한다.
- 누군가가 나의 연봉 정보를 임의로 조작할 수 없도록 바꿔보자.
- `DefensiveCopyViewModelTest`는 실습용이 아니고 안드로이드 개발자를 위한 예시이니 참고만 해보자.

## Step3 - 가독성

불변 객체를 사용할 수 있는 세 가지 방법을 익히고 각각을 가독성 측면에서 비교해보자.

1. inline 상태로 사용
2. 확장 함수로 분리
3. 클래스로 분리

## Step4 - 직접 구현해보기

다음 요구사항을 만족하는 프로그램을 직접 작성해보며 불변 객체에 익숙해져보자.

### 기능 요구사항

- 사원의 휴가 정보(남은 휴가일수, 쓴 휴가 날짜 목록)를 조회할 수 있다.
- 사원은 휴가를 소비할 수 있다.
- 1년 이하의 사원이면 1달마다 1일의 휴가가 부여된다.
- 1년 이상 근속한 사원에게 15일의 휴가가 부여된다.
- 김씨 사원(SpecialEmployee)에게만 특별 휴가가 부여된다. (일급 컬렉션 활용)

### 추가 요구사항

- Side Effect를 끊는걸 의식적으로 연습해보기
    - `var` 키워드 하나도 쓰지않기
    - 클래스 또는 함수 서명(Signature)에서 Mutable 없애기
    - (Optional) 함수 본문에서 Mutable Collection 사용하지 않기
    - (Optional) 비어있는 테스트 코드 완성하기
- 일급 컬렉션을 공부해보고 실습해서 활용해보기

### 힌트

- 유효성 검사를 할 때 다음처럼 작성하게 되면 생성자를 통한 초기화 이후로 값이 변경되지 않으므로 내부 프로퍼티가 중간에 바뀌지 않았다는 것을 믿고 사용할 수 있다.

```kotlin
data class User(val name: String, val email: String) {
    init {
        require(name.isNotBlank())
        require(isValidEmail(email))
    }

    private fun isValidEmail(email: String): Boolean = TODO()
}
```
